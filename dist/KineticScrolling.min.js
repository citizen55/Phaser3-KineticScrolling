var KineticScrolling=function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();(function(){var i=function(t){function e(t,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return s.pointerId=null,s.dragging=!1,s.pressedDown=!1,s.timestamp=0,s.targetX=0,s.targetY=0,s.autoScrollX=!1,s.autoScrollY=!1,s.startX=0,s.startY=0,s.velocityX=0,s.velocityY=0,s.amplitudeX=0,s.amplitudeY=0,s.directionWheel=0,s.velocityWheelX=0,s.velocityWheelY=0,s._allowDragX=!1,s._allowDragY=!1,s.scene.game.isTouchDevice?(s.thresholdOfTapTime=200,s.thresholdOfTapDistance=15):(s.thresholdOfTapTime=150,s.thresholdOfTapDistance=20),s.thresholdReached=!1,s.clickHelperActiveObjects=[],s.settings={kineticMovement:!0,timeConstantScroll:325,hScroll:!0,vScroll:!0,hWheel:!1,vWheel:!0,deltaWheel:30,allowDrag:!1,onUpdate:0},s.camera,s.clearMovementTimer=0,s.kineticDown=!1,s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,Phaser.Plugins.ScenePlugin),s(e,[{key:"boot",value:function(){this.systems.events.on("update",this.update,this)}},{key:"start",value:function(t,e){var i=this;e&&this.configure(e),this.eventEmitter=this.scene.events,this.camera=null==t?scene.cameras.main:t;this.cam;this.eventEmitter=this.game.events,this.scene.input.on("pointerdown",this.beginMove,this),this.scene.input.on("pointermove",this.moveCamera,this),this.scene.input.on("pointerup",this.endMove,this),this.game.events.on("mouseout",this.endMove,this),window.addEventListener&&(window.addEventListener("DOMMouseScroll",this.mouseWheel.bind(this),!1),window.onmousewheel=this.mouseWheel.bind(this)),this.game.events.on("kineticdrag",function(){i.endMove()})}},{key:"beginMove",value:function(t){var e=this;t.camera&&t.camera.id==this.camera.id&&(this.pointerId=t.id,this.startX=t.x,this.startY=t.y,this.pressedDown=!0,this.thresholdReached=!1,this.timestamp=Date.now(),this.beginTime=this.timestamp,this.velocityY=this.amplitudeY=this.velocityX=this.amplitudeX=0,this.timerDown=setTimeout(function(){e.thresholdReached||(e.scene.input.emit("kineticDown",t),e.kineticDown=!0)},this.thresholdOfTapTime+10))}},{key:"moveCamera",value:function(t){if(clearTimeout(this.clearMovementTimer),t.camera&&t.camera.id==this.camera.id||this.endMove(t),this.pressedDown&&this.pointerId===t.id){var e=t.x,i=t.y;this.now=Date.now();var s=this.now-this.timestamp;this.timestamp=this.now;var n=0,o=0;if(!(this.isTap()&&Math.abs(e-this.startX)<this.thresholdOfTapDistance&&Math.abs(i-this.startY)<this.thresholdOfTapDistance)){if(!this.thresholdReached)return this.thresholdReached=!0,this._allowDragY&&(o=i-this.startY)>10&&(console.log("drag y"),this.scene.input.emit("kineticdrag",t),this.scene.input.emit("kineticOff")),this._allowDragX&&(n=e-this.startX)>10&&(console.log("drag x"),this.scene.input.emit("kineticdrag",t),this.scene.input.emit("kineticOff")),this.startX=e,this.startY=i,this.kineticDown?this.scene.input.emit("kineticUp"):(clearTimeout(this.timerDown),this.kineticDown=!1),void this.scene.input.emit("kineticOff");if(this.settings.hScroll&&(0!==(n=e-this.startX)&&(this.dragging=!0),this.startX=e,this.velocityX=1e3*n/(1+s)*.8+.2*this.velocityX,this.camera.scrollX-=n),this.settings.vScroll&&(0!==(o=i-this.startY)&&(this.dragging=!0),this.startY=i,this.velocityY=1e3*o/(1+s)*.8+.2*this.velocityY,this.camera.scrollY-=o),"function"==typeof this.settings.onUpdate){var h=0;this.canCameraMoveX(this.camera,n)&&(h=n);var r=0;this.canCameraMoveY(this.camera,o)&&(r=o),this.settings.onUpdate(h,r)}this.clearMovementTimer=setTimeout(function(){this.velocityX=0,this.velocityY=0}.bind(this),20)}}}},{key:"isTap",value:function(){return this.now-this.beginTime<this.thresholdOfTapTime}},{key:"endMove",value:function(t){(null==t||this.pressedDown)&&(clearTimeout(this.timerDown),this.kineticDown=!1,this.autoScrollX||this.autoScrollY||(this.scene.input.emit("kineticUp"),this.scene.input.emit("kineticClick")),this.scene.input.emit("kineticOff"),clearTimeout(this.clearMovementTimer),this.pointerId=null,this.pressedDown=!1,this.autoScrollX=!1,this.autoScrollY=!1,this.settings.kineticMovement&&(this.now=Date.now(),t&&t.camera&&t.camera.id==this.camera.id&&((this.velocityX>10||this.velocityX<-10)&&(this.amplitudeX=.8*this.velocityX,this.targetX=Math.round(this.camera.scrollX-this.amplitudeX),this.autoScrollX=!0),(this.velocityY>10||this.velocityY<-10)&&(this.amplitudeY=.8*this.velocityY,this.targetY=Math.round(this.camera.scrollY-this.amplitudeY),this.autoScrollY=!0))))}},{key:"update",value:function(t,e){this.elapsed=Date.now()-this.timestamp,this.velocityWheelXAbs=Math.abs(this.velocityWheelX),this.velocityWheelYAbs=Math.abs(this.velocityWheelY);var i=0;this.autoScrollX&&0!=this.amplitudeX&&(i=-this.amplitudeX*Math.exp(-this.elapsed/this.settings.timeConstantScroll),this.canCameraMoveX(this.camera,i)&&(i>.5||i<-.5)?this.camera.scrollX=this.targetX-i:(this.autoScrollX=!1,this.camera.scrollX=this.targetX)),this.autoScrollY&&0!=this.amplitudeY&&(i=-this.amplitudeY*Math.exp(-this.elapsed/this.settings.timeConstantScroll),this.canCameraMoveY(this.camera,i)&&(i>.5||i<-.5)?this.camera.scrollY=this.targetY-i:(this.autoScrollY=!1,this.camera.scrollY=this.targetY)),this.autoScrollX||this.autoScrollY||(this.dragging=!1),this.settings.hWheel&&this.velocityWheelXAbs>.1&&(this.dragging=!0,this.amplitudeX=0,this.autoScrollX=!1,this.camera.scrollX-=this.velocityWheelX,this.velocityWheelX*=.95),this.settings.vWheel&&this.velocityWheelYAbs>.1&&(this.dragging=!0,this.autoScrollY=!1,this.camera.scrollY-=this.velocityWheelY,this.velocityWheelY*=.95)}},{key:"canCameraMoveX",value:function(t,e){var i=t.getScroll(t.scrollX+e,0);return t.scrollX!=i.x}},{key:"canCameraMoveY",value:function(t,e){var i=t.getScroll(0,t.scrollY+e);return t.scrollY!=i.x}},{key:"mouseWheel",value:function(t){if((this.settings.hWheel||this.settings.vWheel)&&this.game.isOver){var e,i=0;i=t.wheelDelta||-t.detail,e=120*(i=Math.max(-1,Math.min(1,i)))/this.settings.deltaWheel,this.directionWheel!=i&&(this.velocityWheelX=0,this.velocityWheelY=0,this.directionWheel=i);var s=this.camera;if(this.settings.hWheel&&(this.autoScrollX=!1,this.velocityWheelX+=e,"function"==typeof this.settings.onUpdate)){var n=0;this.canCameraMoveX(s,e)&&(n=e),this.settings.onUpdate(n,0)}if(this.settings.vWheel&&(this.autoScrollY=!1,this.velocityWheelY+=e,"function"==typeof this.settings.onUpdate)){var o=0;this.canCameraMoveY(s,e)&&(o=e),this.settings.onUpdate(0,o)}}}},{key:"addInteractive",value:function(t){t.setInteractive({useHandCursor:!0}),t.on("pointerdown",function(t){null!=this.onKineticDown&&this.scene.input.on("kineticDown",this.onKineticDown,this),null!=this.onKineticUp&&this.scene.input.on("kineticUp",this.onKineticUp,this),null!=this.onKineticClick&&this.scene.input.on("kineticClick",this.onKineticClick,this),null!=this.onKineticDrag&&this.scene.input.on("kineticdrag",this.onKineticDrag,this),this.scene.input.on("kineticOff",function(){null!=this.onKineticDown&&this.scene.input.off("kineticDown",this.onKineticDown,this),null!=this.onKineticUp&&this.scene.input.off("kineticUp",this.onKineticUp,this),null!=this.onKineticClick&&this.scene.input.off("kineticClick",this.onKineticClick,this),null!=this.onKineticDrag&&this.scene.input.off("kineticdrag",this.onKineticDrag,this),this.scene.input.off("kineticOff")},this)},t)}},{key:"stop",value:function(){clearTimeout(this.timerDown),clearTimeout(this.clearMovementTimer),this.eventEmitter.off("step",this.update),this.pressedDown=!1,this.scene.input.off("pointerdown",this.beginMove,this),this.scene.input.off("pointermove",this.moveCamera,this),this.scene.input.off("pointerup",this.endMove,this),this.game.events.off("mouseout",this.endMove,this),window.addEventListener&&(window.removeEventListener("DOMMouseScroll",this.mouseWheel.bind(this),!1),window.onmousewheel=null)}},{key:"configure",value:function(t){if(t)for(var e in t)this.settings.hasOwnProperty(e)&&(this.settings[e]=t[e]);this.settings.allowDrag&&(this.settings.hScroll&&(this._allowDragY=!0),this.settings.vScroll&&(this._allowDragX=!0))}}]),e}();return t.exports&&(e=t.exports=i),e.KineticScrolling=i,i}).call(void 0)}]);